#!/bin/bash
#
# Dial-home is based on http://www.tunnelsup.com/raspberry-pi-phoning-home-using-a-reverse-remote-ssh-tunnel
#
# Edited for Monit startup 
#


# Configuration settings are stored here:
source /home/ubuntu/scripts/pentest-config.sh


case $1 in
        start)
            echo $$ > $RUNDIR/ssh-dialhome.pid;
                /usr/bin/ssh -N -R $HOME_PORT:localhost:22 $HOME_USER@$HOME_SERVER
                    if [[ $? -eq 0 ]]; then
                    echo `TZ=America/New_York date +"%b %d %H:%M:%S"` Tunnel to jumpbox created successfully
                    else
                    echo `TZ=America/New_York date +"%b %d %H:%M:%S"` An error occurred creating a tunnel to jumpb
ox. RC was $?
                    fi
       ;;
        stop)
        kill `cat $RUNDIR/ssh-dialhome.pid` ;;
    *)
    echo "usage: ssh-dialhome.sh {start|stop}" ;;
esac
exit 0
