PentestPi
========
Setup a RaspberryPi as a dropbox for Pentesting
-----------------------------------------------
This was a small project by our little team to stand up a dropbox for pentesting. Something that we could drop in an environment, would listen on responder, collect any creds, and send outbound to our listener on the Internet. Because these are real creds, we needed them to be securely transmitted. We also need it to dial out and create a reverse SSH tunnel so that we can login from the Internet and get into the target environment. 

(Obligitory Legal) Please, for the love of pete, don't use this if you aren't authorized by the head of your target organization. It's not worth going to jail to prove you're a L33t h@x0r. Don't try this at home. 

Originally, these scripts were built for Ubuntu 14, but that distro required a lot of manual tweaks for each new Pi, and this update is design to limit those manual tweaks.  The Kali2 pi image was used this go-around.

Initial configuration:
-----

Installed Kali ARM image for Pi2/3 onto a MicroSD card. (See http://docs.kali.org/kali-on-arm/install-kali-linux-arm-raspberry-pi and https://www.offensive-security.com/kali-linux-arm-images/)

First steps:
* Change the root password.
* rm /etc/ssh/ssh_host_*
* dpkg-reconfigure openssh-server
* service ssh restart
* apt-get update && apt-get upgrade --yes
* apt-get install tmux monit metasploit-framework 

Disable ipv6 by adding /etc/sysctl.d/local.conf:
* net.ipv6.conf.all.disable_ipv6 = 1
* net.ipv6.conf.default.disable_ipv6 = 1
* net.ipv6.conf.lo.disable_ipv6 = 1

Add a "raspi" user account and set the password, then:
* su raspi
* use git to clone this project

Setup SSH Keys for raspi user:
Created dial-home for reverse SSH connection
        (as seen on http://www.tunnelsup.com/raspberry-pi-phoning-home-using-a-reverse-remote-ssh-tunnel)
        To use, it will try to connect to the server/port in ~/create_ssh_tunnel.sh

Setting up monit to watch services. This will run watchdog scripts for dialing home, uploading files, running responder, etc.
* Config is in /etc/monit/monitrc
* sudo monit -t           : Reviews config to make sure syntax is OK
* sudo monit reload       : reloads config
* sudo monit status       : Shows status of processes
* sudo monit restart all  : Restarts all services that monit controls
* Details are in /var/log/monit.log

Interesting problems:
        The Pi has no built in battery for a clock. Setting dates/times
                in logfiles isn't helpful.

Still todo:

1. Setup macchanger script to change MAC address and get new IP nightly
        Script is in /home/ubuntu, added to Root's cron
        Log of activity is in /home/ubuntu/log
2. Setup denyhosts
3. Firewall?
4. Test battery drain
5. Setup Kippo to capture SSH creds/Vuln scan attempts
6. This does require SSH outbound for reverse connection as well as sending the logs. Would like to try some backup options like HTTPS. 
